<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>ç®¡ç†å¾Œå°</title>
<script src="/socket.io/socket.io.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/css/admin.css"> 
<style>
.role-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; margin-top: 10px; }
.role-table th, .role-table td { padding: 6px; border: 1px solid var(--border-color); text-align: center; }
.role-table th { background: var(--bg-body); font-weight: 600; color: var(--text-sub); }
.role-chk { width: 16px; height: 16px; accent-color: var(--primary); }
</style>
</head>
<body>

<div id="status-bar" data-i18n="status_dis">âš ï¸ ä¼ºæœå™¨é€£ç·šä¸­æ–·...</div>

<div id="login-container">
    <div class="login-header">
        <h1 style="color:var(--primary); margin-bottom:5px;">Admin Console</h1>
        <p style="color:var(--text-sub);" data-i18n="login_title">è«‹ç™»å…¥ç®¡ç†ç³»çµ±</p>
    </div>
    <form onsubmit="return false;">
        <div class="control-group"><input type="text" id="username-input" data-i18n-ph="ph_account" placeholder="å¸³è™Ÿ" autocomplete="username"></div>
        <div class="control-group"><input type="password" id="password-input" data-i18n-ph="ph_password" placeholder="å¯†ç¢¼" autocomplete="current-password"></div>
        <button id="login-button" type="submit" class="btn-primary" data-i18n="login_btn">ç™»å…¥</button>
    </form>
    <p id="login-error" style="color:var(--danger); margin-top:15px;"></p>
</div>

<div id="admin-panel" style="display:none;">
    
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo">âš¡ <span data-i18n="admin_panel">ç®¡ç†å¾Œå°</span></div>
            <div id="sidebar-user-info">Admin</div>
        </div>
        <nav class="sidebar-nav">
            <button class="nav-btn active" data-target="section-live"><span class="nav-icon">ğŸ®</span> <span data-i18n="nav_live">ç¾å ´æ§å°</span></button>
            <button class="nav-btn" data-target="section-stats"><span class="nav-icon">ğŸ“ˆ</span> <span data-i18n="nav_stats">æ•¸æ“šå ±è¡¨</span></button>
            <button class="nav-btn" data-target="section-settings"><span class="nav-icon">âš™ï¸</span> <span data-i18n="nav_settings">ç³»çµ±è¨­å®š</span></button>
            <button class="nav-btn" data-target="section-line"><span class="nav-icon">ğŸ’¬</span> <span data-i18n="nav_line">LINEè¨­å®š</span></button>
        </nav>
        <div class="sidebar-footer">
            <div style="display:flex; gap:10px; margin-bottom:10px;">
                <button id="admin-theme-toggle" class="btn-secondary" style="flex:1;">ğŸŒ™</button>
                <select id="admin-lang-selector" class="lang-select" style="flex:2;"><option value="zh-TW">ç¹é«”ä¸­æ–‡</option><option value="en">English</option></select>
            </div>
            <button id="btn-logout" class="btn-reset-single" style="border:none; color:var(--danger);" data-i18n="logout">ç™»å‡º</button>
        </div>
    </aside>

    <main class="content-area">
        
        <div id="section-live" class="section-group active">
            <div class="dashboard-header">
                <div class="dashboard-item main-stat">
                    <span class="label" data-i18n="dash_curr">ç›®å‰å«è™Ÿ</span>
                    <span class="value big-number" id="number">0</span>
                </div>
                <div class="dashboard-item">
                    <span class="label" data-i18n="dash_issued">å·²ç™¼è™Ÿè‡³</span>
                    <span class="value sub-number" id="issued-number">0</span>
                </div>
                <div class="dashboard-item">
                    <span class="label" data-i18n="dash_wait">ç­‰å¾…çµ„æ•¸</span>
                    <span class="value sub-number" id="waiting-count" style="color:var(--warning);">0</span>
                </div>
            </div>

            <div class="card-container">
                <div class="card-wrapper full-width-mobile">
                    <div class="admin-card control-deck">
                        <h3><span class="card-icon">ğŸ“¢</span> <span data-i18n="card_call">æŒ‡æ®ä¸­å¿ƒ</span></h3>
                        
                        <div class="hero-control-row">
                             <button id="btn-call-next" class="btn-hero" data-i18n="btn_next">ä¸‹ä¸€è™Ÿ â–¶</button>
                        </div>

                        <div class="secondary-actions-row">
                            <button id="btn-call-prev" class="btn-glass" data-i18n="btn_prev">â—€ ä¸Šä¸€è™Ÿ</button>
                            <button id="btn-mark-passed" class="btn-warn" data-i18n="btn_pass">éè™Ÿ</button>
                        </div>

                        <div class="control-group compact-group">
                            <label data-i18n="lbl_assign">æŒ‡å®š / æ’éšŠ</label>
                            <div class="input-group">
                                <div class="quick-actions">
                                    <button class="btn-secondary" id="quick-add-1">+1</button>
                                    <button class="btn-secondary" id="quick-add-5">+5</button>
                                </div>
                                <input type="number" id="manualNumber" placeholder="#" inputmode="numeric" pattern="\d*" min="0" oninput="validity.valid||(value='');">
                                <button id="setNumber" class="btn-secondary success" data-i18n="btn_exec">GO</button>
                            </div>
                        </div>
                        <button id="resetNumber" class="btn-reset-single" data-i18n="btn_reset_call">â†º é‡ç½®å«è™Ÿ</button>
                    </div>
                </div>

                <div class="card-wrapper">
                    <div class="admin-card">
                        <h3><span class="card-icon">ğŸŸï¸</span> <span data-i18n="card_issue">ç™¼è™Ÿç®¡ç†</span></h3>
                        <div class="big-action-row">
                            <button id="btn-issue-prev" class="btn-glass btn-big" data-i18n="btn_recall">â– æ”¶å›</button>
                            <button id="btn-issue-next" class="btn-success btn-big" data-i18n="btn_issue">ç™¼è™Ÿ â•</button>
                        </div>
                        <div class="control-group" style="margin-top:auto;">
                            <label data-i18n="lbl_fix_issue">ä¿®æ­£ç™¼è™Ÿæ•¸</label>
                            <div class="input-group">
                                <input type="number" id="manualIssuedNumber" placeholder="#" inputmode="numeric" min="0" oninput="validity.valid||(value='');">
                                <button id="setIssuedNumber" class="btn-secondary" data-i18n="btn_fix">ä¿®æ­£</button>
                            </div>
                        </div>
                        <button id="resetIssued" class="btn-reset-single" data-i18n="btn_reset_issue">â†º é‡ç½®ç™¼è™Ÿ</button>
                    </div>
                </div>

                <div class="card-wrapper" id="card-editor">
                    <div class="admin-card">
                        <h3><span class="card-icon">ğŸ“</span> <span data-i18n="card_passed">éè™Ÿåå–®</span></h3>
                        <div class="control-group list-editor">
                            <ul id="passed-list-ui"></ul>
                            <div class="input-group">
                                <input type="number" id="new-passed-number" placeholder="No." inputmode="numeric" min="0" oninput="validity.valid||(value='');">
                                <button id="add-passed-btn" class="btn-add">+</button>
                            </div>
                        </div>
                        <button id="resetPassed" class="btn-reset-single" data-i18n="btn_clear_passed">æ¸…ç©ºéè™Ÿ</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="section-stats" class="section-group">
            <div class="card-container">
                <div class="card-wrapper full-width-card">
                    <div class="admin-card">
                        <h3><span class="card-icon">ğŸ“Š</span> <span data-i18n="card_stats">æµé‡åˆ†æ</span></h3>
                        <div class="stats-header">
                            <div><p style="margin:0; color:var(--text-sub);" data-i18n="lbl_today">ä»Šæ—¥äººæ¬¡</p><span id="stats-today-count" style="font-size:2.2rem; font-weight:800; color:var(--primary);">0</span></div>
                            <div class="input-group" style="width:auto;"><button id="btn-refresh-stats" class="btn-secondary" data-i18n="btn_refresh">é‡æ•´</button><button id="btn-export-csv" class="btn-success btn-secondary" style="display:none; color:white;">CSV</button></div>
                        </div>
                        <div id="hourly-chart" class="chart-container"><p style="margin:auto; color:var(--text-sub);">Loading...</p></div>
                        <button id="btn-clear-stats" class="btn-reset-single" style="margin-top:15px;" data-i18n="btn_clear_stats">ğŸ—‘ï¸ æ¸…ç©ºçµ±è¨ˆ</button>
                    </div>
                </div>
                
                <div class="card-wrapper full-width-card">
                    <div class="admin-card">
                        <h3><span class="card-icon">ğŸ“‹</span> <span data-i18n="card_logs">æ“ä½œæ—¥èªŒ</span></h3>
                        <div class="control-group admin-log-container" style="flex:1; display:flex; flex-direction:column;">
                            <ul id="admin-log-ui" class="log-list" style="flex:1;"><li>Wait...</li></ul>
                        </div>
                        <button id="btn-clear-logs" class="btn-reset-single" data-i18n="btn_clear_logs">æ¸…é™¤æ—¥èªŒ</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="section-settings" class="section-group">
            <div class="card-container">
                <div class="card-wrapper">
                    <div class="admin-card">
                        <h3><span class="card-icon">âš™ï¸</span> <span data-i18n="card_sys">ç³»çµ±</span></h3>
                        <div class="settings-grid">
                            <label class="setting-card">
                                <span class="setting-icon">ğŸŒ</span>
                                <span class="setting-label" data-i18n="lbl_public">é–‹æ”¾å‰å°</span>
                                <input type="checkbox" id="public-toggle" checked>
                            </label>
                            <label class="setting-card">
                                <span class="setting-icon">ğŸ”Š</span>
                                <span class="setting-label" data-i18n="lbl_sound">æç¤ºéŸ³æ•ˆ</span>
                                <input type="checkbox" id="sound-toggle">
                            </label>
                        </div>
                        <div class="control-group">
                            <label data-i18n="lbl_tts">TTS èªéŸ³å»£æ’­</label>
                            <div class="input-group">
                                <input type="text" id="broadcast-msg" placeholder="è¼¸å…¥å…§å®¹...">
                                <button id="btn-broadcast" class="btn-secondary" data-i18n="btn_play">æ’­æ”¾</button>
                            </div>
                        </div>
                        <div id="mode-switcher-group" class="control-group form-group-boxed" style="display:none; margin-top:10px;">
                            <label data-i18n="lbl_mode">å–è™Ÿæ¨¡å¼</label>
                            <div style="display:flex; gap:15px; margin-top:5px;">
                                <label><input type="radio" name="systemMode" value="ticketing" checked> <span data-i18n="mode_online">ç·šä¸Šå–è™Ÿ</span></label>
                                <label><input type="radio" name="systemMode" value="input"> <span data-i18n="mode_manual">æ‰‹å‹•è¼¸å…¥</span></label>
                            </div>
                        </div>
                        <button id="resetAll" class="btn-reset-single" style="color:var(--danger); border-color:var(--danger);" data-i18n="btn_reset_all">ğŸ’¥ å…¨åŸŸé‡ç½®</button>

                        <div class="mobile-only-settings">
                            <div class="control-group" style="display:flex; gap:10px;">
                                <button id="admin-theme-toggle-mobile" class="btn-secondary" style="flex:1;">ğŸŒ™ Theme</button>
                                <select id="admin-lang-selector-mobile" class="lang-select" style="flex:2;">
                                    <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
                                    <option value="en">English</option>
                                </select>
                            </div>
                            <button id="btn-logout-mobile" class="btn-reset-single" style="color:var(--danger); border-color:var(--danger); margin-top:10px;" data-i18n="logout">ç™»å‡º</button>
                        </div>
                    </div>
                </div>

                <div class="card-wrapper">
                    <div class="admin-card">
                        <h3><span class="card-icon">ğŸŸ¢</span> <span data-i18n="card_online">åœ¨ç·šç®¡ç†</span></h3>
                        <div class="control-group list-editor" style="flex:1;">
                            <ul id="online-users-list" style="min-height:100px;"><li>Loading...</li></ul>
                        </div>
                    </div>
                </div>

                <div class="card-wrapper">
                    <div class="admin-card">
                        <h3><span class="card-icon">ğŸ”—</span> <span data-i18n="card_links">é€£çµç®¡ç†</span></h3>
                        <div class="control-group list-editor">
                            <ul id="featured-list-ui"></ul>
                            <div class="input-group vertical">
                                <input type="text" id="new-link-text" data-i18n-ph="ph_link_name" placeholder="åç¨±">
                                <div class="input-group"><input type="text" id="new-link-url" placeholder="URL"><button id="add-featured-btn" class="btn-add">+</button></div>
                            </div>
                        </div>
                        <button id="resetFeaturedContents" class="btn-reset-single" data-i18n="btn_clear_links">æ¸…ç©ºé€£çµ</button>
                    </div>
                </div>

                <div class="card-wrapper" id="card-user-management" style="display:none;">
                    <div class="admin-card">
                        <h3><span class="card-icon">ğŸ‘¥</span> <span data-i18n="card_users">å¸³è™Ÿç®¡ç†</span></h3>
                        <div class="control-group list-editor">
                            <ul id="user-list-ui"></ul>
                            <label data-i18n="lbl_add_user">æ–°å¢å¸³è™Ÿ</label>
                            <div class="input-group vertical">
                                <div class="input-group">
                                    <input type="text" id="new-user-username" data-i18n-ph="ph_account" placeholder="å¸³è™Ÿ">
                                    <input type="text" id="new-user-nickname" data-i18n-ph="ph_nick" placeholder="æš±ç¨±">
                                </div>
                                <div class="input-group">
                                    <input type="password" id="new-user-password" data-i18n-ph="ph_password" placeholder="å¯†ç¢¼">
                                    <select id="new-user-role" class="role-select">
                                        <option value="VIEWER">Viewer</option>
                                        <option value="OPERATOR" selected>Operator</option>
                                        <option value="MANAGER">Manager</option>
                                        <option value="ADMIN">Admin</option>
                                    </select>
                                    <button id="add-user-btn" class="btn-add">+</button>
                                </div>
                            </div>
                        </div>
                        
                        <div id="role-editor-container" style="margin-top:20px; border-top:1px dashed var(--border-color); padding-top:15px; display:none;">
                            <label style="font-weight:bold; color:var(--text-main);">æ¬Šé™è¨­å®š (Super Admin)</label>
                            <div id="role-editor-content">Loading...</div>
                            <button id="btn-save-roles" class="btn-secondary success" style="width:100%; margin-top:10px;">å„²å­˜æ¬Šé™è®Šæ›´</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="section-line" class="section-group">
            <div class="card-container">
                <div class="card-wrapper full-width-card" style="grid-column: 1 / -1;">
                    <div class="admin-card">
                        <h3><span class="card-icon">ğŸ’¬</span> LINE è¨­å®š</h3>
                        <div class="security-box" id="unlock-pwd-group" style="display:none;">
                            <div class="sec-icon">ğŸ”‘</div>
                            <div class="sec-content">
                                <span class="sec-title">å¾Œå°å®‰å…¨é–</span>
                                <div class="input-group">
                                    <input type="text" id="line-unlock-pwd" placeholder="è¨­å®š Line è§£é–å¯†ç¢¼..." style="background:var(--bg-body);">
                                    <button id="btn-save-unlock-pwd" class="btn-secondary" style="background:#fff7ed; color:#c2410c; border:1px solid #fed7aa;" data-i18n="btn_save">å„²å­˜</button>
                                </div>
                            </div>
                        </div>
                        <div class="control-group list-editor">
                            <ul id="line-settings-list-ui"><li>Loading settings...</li></ul>
                        </div>
                        <div class="control-group" style="margin-top:20px; display:flex; gap:10px; justify-content: flex-end;">
                            <button id="btn-reset-line-msg" class="btn-reset-single" style="width:auto;" data-i18n="btn_restore">æ¢å¾©é è¨­å€¼</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<div id="edit-stats-overlay" class="modal-overlay" style="display:none;">
    <div class="modal-content">
        <h3 data-i18n="modal_edit">ç·¨è¼¯æ•¸æ“š</h3>
        <div class="modal-actions">
            <button id="btn-stats-minus" class="btn-circle btn-warn">-1</button>
            <span id="modal-current-count" style="font-size:2.5rem; font-weight:800; min-width:60px;">0</span>
            <button id="btn-stats-plus" class="btn-circle btn-success">+1</button>
        </div>
        <button id="btn-modal-close" class="btn-secondary" style="width:100%;" data-i18n="btn_done">å®Œæˆ</button>
    </div>
</div>

<div id="toast-notification"></div>
<script src="/js/admin.js"></script> 
</body>
</html>
